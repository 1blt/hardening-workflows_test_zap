version: '3.8'

# Local testing setup with ZAP and vulnerable applications
# Usage: docker-compose -f docker-compose.local.yml up

services:
  zap:
    image: ghcr.io/zaproxy/zaproxy:stable
    container_name: zap-local
    ports:
      - "8080:8080"
      - "8090:8090"
    volumes:
      - ./local-reports:/zap/wrk:rw
    command: zap-webswing.sh
    networks:
      - test-network

  juice-shop:
    image: bkimminich/juice-shop:latest
    container_name: juiceshop-local
    ports:
      - "3000:3000"
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 10s
      timeout: 5s
      retries: 3
    networks:
      - test-network

  dvwa:
    image: vulnerables/web-dvwa:latest
    container_name: dvwa-local
    ports:
      - "8081:80"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80"]
      interval: 10s
      timeout: 5s
      retries: 3
    networks:
      - test-network

  podinfo:
    image: ghcr.io/stefanprodan/podinfo:latest
    container_name: podinfo-local
    ports:
      - "9898:9898"
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:9898"]
      interval: 10s
      timeout: 5s
      retries: 3
    networks:
      - test-network

networks:
  test-network:
    driver: bridge
